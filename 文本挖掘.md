# 文本挖掘从小白到精通（一）---语料、向量空间和模型的概念

## 一、gensim定义

`gensim`是一种**通过检查词汇模式（或更高级别的结构，如语句或文档）**来发现**文档语义结构（Semantic Structure）**的工具



## 二、genism工作方式

`gensim`通过**语料库** ，并在语料库中生成**文本的向量表示（Vector Representation of the Text）**来实现这一点。文本的向量表示可用于**训练模型** --- 它是用于创建不同的文本数据（蕴含语义）表示的算法。



## 三、语料、向量空间与模型

### 1、语料（corpus）

一个**语料库**是**数字文档的集合（A Collection of Digital Documents）**。这个集合是`gensim`的输入，gensim将从中推断文档的结构或主题。从语料库中推断出的潜在结构（Latent Structure）可用于将主题分配给先前不存在于仅用于训练的语料库中的新文档。故此集合也成为**训练语料库**。

```python
# 在命令行中（我是在anaconda prompt）中输入命令 pip install jieba
import jieba 


#jieba.add_word()表示向分词词典中增加新词，此处是防止知识图谱被切错词
jieba.add_word('知识图谱')


# 将12个文档中的语句放入列表中
raw_corpus = ['商业新知:知识图谱为内核,构建商业创新服务完整生态。',
'如何更好利用知识图谱技术做反欺诈? 360金融首席数据科学家沈赟开讲。',
'知识管理 | 基于知识图谱的国际知识管理领域可视化分析。',
'一文详解达观数据知识图谱技术与应用。',
'知识图谱技术落地金融行业的关键四步。',
'一文读懂知识图谱的商业应用进程及技术背景。',
'海云数据CPO王斌:打造大数据可视分析与AI应用的高科技企业。',
'智能产业|《人工智能标准化白皮书2018》带来创新创业新技术标准。',
'国家语委重大科研项目“中华经典诗词知识图谱构建技术研究”开题。',
'最全知识图谱介绍:关键技术、开放数据集、应用案例汇总。',
'中译语通Jove Mind知识图谱平台 引领企业智能化发展。',
'知识图谱:知识图谱赋能企业数字化转型，为企业升级转型注入新能量。']

#jieba.lcut()返回精确模式，输出的分词能够完整且不多余地组成原始文本
#' '.join(jieba.lcut(i))是以空格作为分隔符，将jieba.lcut(i)所有的元素合并成一个新的字符串
raw_corpus = [' '.join(jieba.lcut(i)) for i in raw_corpus] #列表推导式
print(raw_corpus)

```



作为示例，为了简洁起见，仅删除语料库中的停用词和在语料库中只出现一次的词汇。

#### 注释：stopwords文档自行下载[(14条消息) stopwords.txt中英文数据集，四大学机器智能实验室停用词库,哈工大停用词表,中文停用词表,百度停用词表百度网盘下载_woshishui68892的博客-CSDN博客](https://blog.csdn.net/woshishui68892/article/details/108203121)

```python
# 移除常用词以及分词
stoplist = [i.strip() for i in open('datasets/stopwords_zh.txt',encoding='utf-8').readlines()]


#将文档中可能存在的西文字符小写化，按空格进行拆分，且去停用词
texts = [[word for word in document.lower().split() if word not in stoplist]
         for document in raw_corpus]
#相当于代码
#texts=[]
#for document in raw_corpus:
#    words=[]
#    for word in document.lower().split():
#        if word not in stoplist():
#            words.append(word)        
#texts.append(words)    


#计算词频
from collections import defaultdict
frequency = defaultdict(int)
for text in texts:
    for token in text:
        frequency[token] += 1


# 仅保留词频数高于1的词汇
processed_corpus = [[token for token in text if frequency[token] > 1] for text in texts]
#processed_corpus=[]
#for text in texts:
#	 tokens=[]
#	 for token in text:
#		 if frequency[token]>1:
#			 tokens.append(token)
#processed_corpus(tokens)
print(processed_corpus)
```



将语料库中的每个词汇与唯一的整数ID相关联。使用`gensim.corpora.Dictionary`完成。这个词典定义了之前预处理后的语料中的词汇。

```python
#导入gensim库——pip install gensim
from gensim import corpora

dictionary = corpora.Dictionary(processed_corpus)
print(dictionary)

```



### 2.向量空间**（Vector Space）**

为了推断语料库中的**潜在结构（Latent Structure）**，我们需要一种可用于数学操作（比如，加减乘除等运算）的文档表示方法。一种方法是将每个文档表示为向量。有各种用于创建文档的向量表示的方法，其中一个简单的方法是**词袋模型(Bag-of-Words Model)**。

#### （1）词袋模型

文本向量化——指用数值向量来表示文本的语义，即，把人类可读的文本转化成机器可读形式。

例：

Jane wants to go to Shenzhen.
Bob  wants to go to Shanghai.

[Jane, wants, to, go, Shenzhen, Bob, Shanghai]

[1,1,2,1,1,0,0]
[0,1,2,1,0,1,1]

#### （2）处理过的语料库中有14个不同的词汇，这意味着语料库中的每个文档将由这个14维向量的词袋模型来表示。使用字典将分词后的文档转换为14维向量。

```python
#dictionary.token2id是一个字典，它将词语映射到一个唯一的整数ID。这些数字ID可以用于训练模型、计算文本相似度等任务。
print(dictionary.token2id)
```

例如，假设想要对“知识图谱为企业转型助力”这个语句进行向量化（该语句不在我们原来的语料库中）,可以使用dictionary的`doc2bow`方法为该语句创建词袋表示，该方法返回词汇计数的稀疏表示：

```python
new_doc = "知识图谱 为 企业 转型 助力"  #已分词，便于后续处理
new_vec = dictionary.doc2bow(new_doc.lower().split()) #将文档中可能存在的西文字符小写化
print(new_vec)
```

将整个原始语料库转换为向量列表:

```python
bow_corpus = [dictionary.doc2bow(text) for text in processed_corpus] #processed_corpus 是处理后词频数高于1的词汇
print(bow_corpus)
```

### 3、模型**（Model）**

对测试语料库进行向量化后，使用*models*对其进行转换。使用模型作为抽象术语，指的是从一个文档表示到另一个文档表示的转换。 在`gensim`中，文档表示为向量，因而模型可以被认为是两个向量空间之间的转换。

一个简单的模型示例是TF-IDF。 TF-IDF模型将向量从词袋表示（Bag-of-Words Representation）转换为向量空间，其中频率计数根据语料库中每个单词的相对稀有度（the relative rarity of each word in the corpus）进行加权。

***注释：TF-IDF是NLP中一种常用的统计方法，用以评估一个字词对于一个文件集或一个语料库中的其中一份文件的重要程度，通常用于提取文本的特征，即关键词。***

简单的例子。初始化tf-idf模型，在测试语料库上进行训练，然后对字符串“知识图谱这种技术是企业转型的利器”进行转换： 

```python
from gensim import models
# 训练模型
tfidf = models.TfidfModel(bow_corpus) #bow_corpus是原始语料库转化成的向量列表
# 对"知识图谱这种技术是企业转型的利器"进行转换
tfidf[dictionary.doc2bow("知识图谱 这种 技术 是 企业 转型 的 利器".split())] #dictionary的`doc2bow`方法为该语句创建词袋表示，该方法返回词汇计数的稀疏表示
```
